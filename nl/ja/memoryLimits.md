---

copyright:
  years: 2015, 2017
lastupdated: "2017-04-18"

---

{:new_window: target="_blank"}
{:codeblock: .codeblock}

# メモリー制限および Liberty ビルドパック
{: #memory_limits}

Liberty ビルドパックでアプリケーションをデプロイするときには、メモリー限度を指定する必要があります。

## トラブルの回避

メモリー限度を 256 MB と指定して Liberty ビルドパックでデプロイされた「Hello World」サーブレットは、
正しくデプロイおよび実行されない可能性があります。これは、デプロイされた場合、
256 M 限度近くで実行します。単純なアプリケーションでも、メモリー限度として最小 512 M を指定することを検討してください。

## メモリー制限および Liberty ビルドパック
{: #memory_limits_and_liberty}


Liberty ビルドパックでアプリケーションをデプロイする際、
メモリー限度を指定するようプロンプトが出されます。

指定するメモリー限度を決定するには、
Java アプリケーション・ヒープのサイズを指定するのではないことを理解することが重要です。指定するのは、プロセス全体が使用できるメモリー量です。この量には、以下のコンポーネントによって使用されるメモリーが含まれます。

* warden コンテナーによって使用されるメモリー。
* カーネル拡張およびシステム・ライブラリーをプロセスにマップするために使用されるメモリー。
* JVM 実行可能ファイル、JVM 作業ヒープ、jit スペース、および圧縮されたリファレンス用に使用されるメモリー。
* クラス (アプリケーション・サーバーおよびアプリケーション)、スレッド・スタック、および直接 IO バッファー用に使用されるメモリー。
* Java アプリケーション・ヒープによって使用されるメモリー。

JVM メモリー使用について詳しくは、developerWorks の記事[『Thanks for the memory, Linux』](http://www.ibm.com/developerworks/library/j-nativememory-linux/)を参照してください。

アプリケーションをデプロイすると、
プロセス全体のメモリー使用量がモニターされます。メモリー使用量が、アプリケーションをデプロイしたときに指定したメモリー限度を超えると、
カーネルはプロセスを停止します。この処置は警告なしで実行され、以下のように明示される可能性があります。

* アプリケーションのデプロイメント中にメモリー限度を超えた場合、障害が発生したことを知らせるメッセージが出されます。例えば、アプリケーションでフラッピングが起こっている場合があります。アプリケーションが何度も開始しようとして、
いつも失敗に終わっているといった状況の場合もあります。あるいは、アプリケーション・デプロイメントが失敗したことを示すメッセージを受け取ることもあります。
* アプリケーションがサービス中にメモリー限度を超えた場合、プロセスは停止されます。Cloud Foundry はアプリケーションの再始動を試みます。
アプリケーションは再始動する可能性がありますが、一定期間は使用不可になります。

## ヒープ・メモリーの指定
{: #specifying_heap_memory}

アプリケーションに割り振られるヒープ・メモリーの最大量をさまざまな方法でカスタマイズできます。

*  JVM_ARGS 環境変数および -Xmx 引数を使用します。例えば、最大ヒープ・サイズを 512 M に設定するには、以下のコマンドを使用し、その後でアプリケーションの再ステージングを行います。

```
    $ cf set-env myapp JVM_ARGS -Xmx512m
```
{: codeblock}

* アプリケーションが[サーバー・ディレクトリー](optionsForPushing.html#server_directory)または[パッケージされたサーバー](optionsForPushing.html#packaged_server)である場合、jvm.options ファイル内に -Xmx 引数を指定できます。

* JBP_CONFIG_IBMJDK 環境変数を使用して、ヒープ・サイズ率を指定できます。heap_size_ratio は、使用可能メモリーのうちどれだけの量をヒープに割り振るのかを指定する浮動小数点値です。例えば、使用可能メモリーの半分をヒープに割り振るには、以下のコマンドを実行し、その後でアプリケーションの再ステージングを行います。

```
    $ cf set-env myapp JBP_CONFIG_IBMJDK "heap_size_ratio: 0.50"
```
{: codeblock}
